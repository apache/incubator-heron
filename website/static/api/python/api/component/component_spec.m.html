<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>heronpy.api.component.component_spec API documentation</title>
    <meta name="description" content="component_spec.py" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#heronpy.api.component.component_spec.TOPOLOGY_COMPONENT_PARALLELISM">TOPOLOGY_COMPONENT_PARALLELISM</a></li>
  </ul>

    </li>


    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#heronpy.api.component.component_spec.GlobalStreamId">GlobalStreamId</a></span>
        
          
  <ul>
    <li class="mono"><a href="#heronpy.api.component.component_spec.GlobalStreamId.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#heronpy.api.component.component_spec.HeronComponentSpec">HeronComponentSpec</a></span>
        
          
  <ul>
    <li class="mono"><a href="#heronpy.api.component.component_spec.HeronComponentSpec.__init__">__init__</a></li>
    <li class="mono"><a href="#heronpy.api.component.component_spec.HeronComponentSpec.get_out_streamids">get_out_streamids</a></li>
    <li class="mono"><a href="#heronpy.api.component.component_spec.HeronComponentSpec.get_protobuf">get_protobuf</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">heronpy.api.component.component_spec</span> module</h1>
  <p>component_spec.py</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-heronpy.api.component.component_spec', this);">Show source &equiv;</a></p>
  <div id="source-heronpy.api.component.component_spec" class="source">
    <div class="codehilite"><pre><span></span><span class="c1"># Copyright 2016 Twitter. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#    http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>
<span class="sd">&#39;&#39;&#39;component_spec.py&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">uuid</span>

<span class="kn">from</span> <span class="nn">heronpy.api.serializer</span> <span class="kn">import</span> <span class="n">default_serializer</span>
<span class="kn">from</span> <span class="nn">heronpy.api.api_constants</span> <span class="kn">import</span> <span class="n">TOPOLOGY_COMPONENT_PARALLELISM</span>
<span class="kn">from</span> <span class="nn">heronpy.proto</span> <span class="kn">import</span> <span class="n">topology_pb2</span>

<span class="kn">from</span> <span class="nn">heronpy.api.stream</span> <span class="kn">import</span> <span class="n">Stream</span><span class="p">,</span> <span class="n">Grouping</span>

<span class="c1"># pylint: disable=too-many-instance-attributes</span>
<span class="k">class</span> <span class="nc">HeronComponentSpec</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Class to specify the information and location of components in a topology</span>

<span class="sd">  This class is generated by the ``spec()`` method of Spout and Bolt class and</span>
<span class="sd">  specifies how this component is located in the topology and how it is connected to</span>
<span class="sd">  the other components. This class also retains the Python class path of the component,</span>
<span class="sd">  so pex_loader can load the component appropriately.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">python_class_path</span><span class="p">,</span> <span class="n">is_spout</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span>
               <span class="n">inputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_args</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">python_class_path</span><span class="p">,</span> <span class="n">is_spout</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">python_class_path</span> <span class="o">=</span> <span class="n">python_class_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_spout</span> <span class="o">=</span> <span class="n">is_spout</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parallelism</span> <span class="o">=</span> <span class="n">par</span>

    <span class="c1"># inputs, outputs, config will be sanitized later</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">custom_config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="c1"># This is used for identification, especially when name is not specified by argument</span>
    <span class="c1"># Note that ``self.name`` might not be available until it is set by TopologyType metaclass</span>
    <span class="c1"># so this is necessary for identification purposes. Used mainly by GlobalStreamId.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">_sanitize_args</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">py_class_path</span><span class="p">,</span> <span class="n">is_spout</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="c1"># name can be None at the time this spec is initialized</span>
    <span class="k">assert</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">py_class_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_spout</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">par</span> <span class="o">&gt;</span> <span class="mi">0</span>

  <span class="k">def</span> <span class="nf">get_protobuf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns protobuf message (Spout or Bolt) of this component&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spout</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spout</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bolt</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_get_spout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns Spout protobuf message&quot;&quot;&quot;</span>
    <span class="n">spout</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Spout</span><span class="p">()</span>
    <span class="n">spout</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_base_component</span><span class="p">())</span>

    <span class="c1"># Add output streams</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_out_streams</span><span class="p">(</span><span class="n">spout</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spout</span>

  <span class="k">def</span> <span class="nf">_get_bolt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns Bolt protobuf message&quot;&quot;&quot;</span>
    <span class="n">bolt</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Bolt</span><span class="p">()</span>
    <span class="n">bolt</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_base_component</span><span class="p">())</span>

    <span class="c1"># Add streams</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_in_streams</span><span class="p">(</span><span class="n">bolt</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_out_streams</span><span class="p">(</span><span class="n">bolt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bolt</span>

  <span class="k">def</span> <span class="nf">_get_base_component</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns Component protobuf message&quot;&quot;&quot;</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">ComponentObjectSpec</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;PYTHON_CLASS_NAME&quot;</span><span class="p">)</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_class_path</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comp_config</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">comp</span>

  <span class="k">def</span> <span class="nf">_get_comp_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns component-specific Config protobuf message</span>

<span class="sd">    It first adds ``topology.component.parallelism``, and is overriden by</span>
<span class="sd">    a user-defined component-specific configuration, specified by spec().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proto_config</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Config</span><span class="p">()</span>

    <span class="c1"># first add parallelism</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">proto_config</span><span class="o">.</span><span class="n">kvs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
    <span class="n">key</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">TOPOLOGY_COMPONENT_PARALLELISM</span>
    <span class="n">key</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallelism</span><span class="p">)</span>
    <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">ConfigValueType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;STRING_VALUE&quot;</span><span class="p">)</span>

    <span class="c1"># iterate through self.custom_config</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">sanitized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_config</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sanitized</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
          <span class="n">kvs</span> <span class="o">=</span> <span class="n">proto_config</span><span class="o">.</span><span class="n">kvs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">ConfigValueType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;STRING_VALUE&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="c1"># need to serialize</span>
          <span class="n">kvs</span> <span class="o">=</span> <span class="n">proto_config</span><span class="o">.</span><span class="n">kvs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">serialized_value</span> <span class="o">=</span> <span class="n">default_serializer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">ConfigValueType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;PYTHON_SERIALIZED_VALUE&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">proto_config</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">_sanitize_config</span><span class="p">(</span><span class="n">custom_config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether ``custom_config`` is sane and returns a sanitized dict &lt;str -&gt; (str|object)&gt;</span>

<span class="sd">    It checks if keys are all strings and sanitizes values of a given dictionary as follows:</span>

<span class="sd">    - If string, number or boolean is given as a value, it is converted to string.</span>
<span class="sd">      For string and number (int, float), it is converted to string by a built-in ``str()`` method.</span>
<span class="sd">      For a boolean value, ``True`` is converted to &quot;true&quot; instead of &quot;True&quot;, and ``False`` is</span>
<span class="sd">      converted to &quot;false&quot; instead of &quot;False&quot;, in order to keep the consistency with</span>
<span class="sd">      Java configuration.</span>

<span class="sd">    - If neither of the above is given as a value, it is inserted into the sanitized dict as it is.</span>
<span class="sd">      These values will need to be serialized before adding to a protobuf message.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Component-specific configuration must be given as a dict type, given: </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">custom_config</span><span class="p">)))</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Key for component-specific configuration must be string, given: </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>

      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">sanitized</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">sanitized</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">sanitized</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">sanitized</span>

  <span class="k">def</span> <span class="nf">_add_in_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bolt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds inputs to a given protobuf Bolt message&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>
    <span class="c1"># sanitize inputs and get a map &lt;GlobalStreamId -&gt; Grouping&gt;</span>
    <span class="n">input_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_inputs</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">global_streamid</span><span class="p">,</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="n">in_stream</span> <span class="o">=</span> <span class="n">bolt</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
      <span class="n">in_stream</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stream_id</span><span class="p">(</span><span class="n">global_streamid</span><span class="o">.</span><span class="n">component_id</span><span class="p">,</span>
                                                    <span class="n">global_streamid</span><span class="o">.</span><span class="n">stream_id</span><span class="p">))</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gtype</span><span class="p">,</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">FIELDS</span><span class="p">):</span>
        <span class="c1"># it&#39;s a field grouping</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">gtype</span> <span class="o">=</span> <span class="n">gtype</span><span class="o">.</span><span class="n">gtype</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">grouping_fields</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stream_schema</span><span class="p">(</span><span class="n">gtype</span><span class="o">.</span><span class="n">fields</span><span class="p">))</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gtype</span><span class="p">,</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">):</span>
        <span class="c1"># it&#39;s a custom grouping</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">gtype</span> <span class="o">=</span> <span class="n">gtype</span><span class="o">.</span><span class="n">gtype</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">custom_grouping_object</span> <span class="o">=</span> <span class="n">gtype</span><span class="o">.</span><span class="n">python_serialized</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">CustomGroupingObjectType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;PYTHON_OBJECT&quot;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">gtype</span> <span class="o">=</span> <span class="n">gtype</span>

  <span class="c1"># pylint: disable=too-many-branches</span>
  <span class="k">def</span> <span class="nf">_sanitize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sanitizes input fields and returns a map &lt;GlobalStreamId -&gt; Grouping&gt;&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
      <span class="c1"># inputs are dictionary, must be either &lt;HeronComponentSpec -&gt; Grouping&gt; or</span>
      <span class="c1"># &lt;GlobalStreamId -&gt; Grouping&gt;</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">grouping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">is_grouping_sane</span><span class="p">(</span><span class="n">grouping</span><span class="p">):</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;A given grouping is not supported&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">):</span>
          <span class="c1"># use default streamid</span>
          <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># should not happen as TopologyType metaclass sets name attribute</span>
            <span class="c1"># before calling this method</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;In _sanitize_inputs(): HeronComponentSpec doesn&#39;t have a name&quot;</span><span class="p">)</span>
          <span class="n">global_streamid</span> <span class="o">=</span> <span class="n">GlobalStreamId</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">)</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">global_streamid</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouping</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">GlobalStreamId</span><span class="p">):</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouping</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not supported as a key to inputs&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="c1"># inputs are lists, must be either a list of HeronComponentSpec or GlobalStreamId</span>
      <span class="c1"># will use SHUFFLE grouping</span>
      <span class="k">for</span> <span class="n">input_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_obj</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">input_obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># should not happen as TopologyType metaclass sets name attribute</span>
            <span class="c1"># before calling this method</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;In _sanitize_inputs(): HeronComponentSpec doesn&#39;t have a name&quot;</span><span class="p">)</span>
          <span class="n">global_streamid</span> <span class="o">=</span> <span class="n">GlobalStreamId</span><span class="p">(</span><span class="n">input_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">)</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">global_streamid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">SHUFFLE</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_obj</span><span class="p">,</span> <span class="n">GlobalStreamId</span><span class="p">):</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">input_obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">SHUFFLE</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not supported as an input&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_obj</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Inputs must be a list, dict, or None, given: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ret</span>

  <span class="k">def</span> <span class="nf">_add_out_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spbl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds outputs to a given protobuf Bolt or Spout message&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="c1"># sanitize outputs and get a map &lt;stream_id -&gt; out fields&gt;</span>
    <span class="n">output_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_outputs</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">out_fields</span> <span class="ow">in</span> <span class="n">output_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="n">out_stream</span> <span class="o">=</span> <span class="n">spbl</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
      <span class="n">out_stream</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stream_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">))</span>
      <span class="n">out_stream</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stream_schema</span><span class="p">(</span><span class="n">out_fields</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">_sanitize_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sanitizes output fields and returns a map &lt;stream_id -&gt; list of output fields&gt;&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument to outputs must be either list or tuple, given: </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Outputs must be a list of strings or Streams, given: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># it&#39;s a default stream</span>
        <span class="k">if</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># output is a Stream object</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">stream_id</span> <span class="o">==</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="ow">and</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
          <span class="c1"># some default stream fields are already in there</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">fields</span>
    <span class="k">return</span> <span class="n">ret</span>

  <span class="k">def</span> <span class="nf">get_out_streamids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a set of output stream ids registered for this component&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument to outputs must be either list or tuple, given: </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)))</span>
    <span class="n">ret_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Outputs must be a list of strings or Streams, given: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
      <span class="n">ret_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">stream_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">ret_lst</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get GlobalStreamId for a given stream_id&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_out_streamids</span><span class="p">():</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A given stream id does not exist on this component: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stream_id</span><span class="p">)</span>

    <span class="n">component_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span>
    <span class="k">return</span> <span class="n">GlobalStreamId</span><span class="p">(</span><span class="n">componentId</span><span class="o">=</span><span class="n">component_id</span><span class="p">,</span> <span class="n">streamId</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">_get_stream_id</span><span class="p">(</span><span class="n">comp_name</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a StreamId protobuf message&quot;&quot;&quot;</span>
    <span class="n">proto_stream_id</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">StreamId</span><span class="p">()</span>
    <span class="n">proto_stream_id</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">stream_id</span>
    <span class="n">proto_stream_id</span><span class="o">.</span><span class="n">component_name</span> <span class="o">=</span> <span class="n">comp_name</span>
    <span class="k">return</span> <span class="n">proto_stream_id</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">_get_stream_schema</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a StreamSchema protobuf message&quot;&quot;&quot;</span>
    <span class="n">stream_schema</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">StreamSchema</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">stream_schema</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
      <span class="n">key</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">field</span>
      <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;OBJECT&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stream_schema</span>

<span class="k">class</span> <span class="nc">GlobalStreamId</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Wrapper class to define stream_id and its component name</span>

<span class="sd">  Constructor method is compatible with StreamParse&#39;s GlobalStreamId class, although</span>
<span class="sd">  the object itself is completely different, as Heron does not use Thrift.</span>
<span class="sd">  This is mainly used for declaring input fields when defining a topology, and internally</span>
<span class="sd">  in HeronComponentSpec.</span>

<span class="sd">  Note that topology writers never have to create an instance of this class by themselves,</span>
<span class="sd">  as it is created automatically.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">componentId</span><span class="p">,</span> <span class="n">streamId</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :type componentId: str or HeronComponentSpec</span>
<span class="sd">    :param componentId: component id from which the tuple is emitted, or HeronComponentSpec object.</span>
<span class="sd">    :type streamId: str</span>
<span class="sd">    :param streamId: stream id through which the tuple is transmitted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">componentId</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;GlobalStreamId: componentId must be either string or HeronComponentSpec&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">streamId</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;GlobalStreamId: streamId must be string type&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span> <span class="o">=</span> <span class="n">componentId</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span> <span class="o">=</span> <span class="n">streamId</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">component_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns component_id of this GlobalStreamId</span>

<span class="sd">    Note that if HeronComponentSpec is specified as componentId and its name is not yet</span>
<span class="sd">    available (i.e. when ``name`` argument was not given in ``spec()`` method in Bolt or Spout),</span>
<span class="sd">    this property returns a message with uuid. However, this is provided only for safety</span>
<span class="sd">    with __eq__(), __str__(), and __hash__() methods, and not meant to be called explicitly</span>
<span class="sd">    before TopologyType class finally sets the name attribute of HeronComponentSpec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># HeronComponentSpec instance&#39;s name attribute might not be available until</span>
        <span class="c1"># TopologyType metaclass finally sets it. This statement is to support __eq__(),</span>
        <span class="c1"># __hash__() and __str__() methods with safety, as raising Exception is not</span>
        <span class="c1"># appropriate this case.</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;No name available for HeronComponentSpec yet, uuid: </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="o">.</span><span class="n">uuid</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="o">.</span><span class="n">name</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Component Id for this GlobalStreamId is not properly set: &lt;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&gt;&quot;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="p">)))</span>

  <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;component_id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">component_id</span> \
           <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;stream_id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">stream_id</span>

  <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">())</span>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="heronpy.api.component.component_spec.TOPOLOGY_COMPONENT_PARALLELISM" class="name">var <span class="ident">TOPOLOGY_COMPONENT_PARALLELISM</span></p>
      
  
  <div class="source_cont">
</div>

      </div>


    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="heronpy.api.component.component_spec.GlobalStreamId" class="name">class <span class="ident">GlobalStreamId</span></p>
      
  
    <div class="desc"><p>Wrapper class to define stream_id and its component name</p>
<p>Constructor method is compatible with StreamParse's GlobalStreamId class, although
the object itself is completely different, as Heron does not use Thrift.
This is mainly used for declaring input fields when defining a topology, and internally
in HeronComponentSpec.</p>
<p>Note that topology writers never have to create an instance of this class by themselves,
as it is created automatically.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-heronpy.api.component.component_spec.GlobalStreamId', this);">Show source &equiv;</a></p>
  <div id="source-heronpy.api.component.component_spec.GlobalStreamId" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">GlobalStreamId</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Wrapper class to define stream_id and its component name</span>

<span class="sd">  Constructor method is compatible with StreamParse&#39;s GlobalStreamId class, although</span>
<span class="sd">  the object itself is completely different, as Heron does not use Thrift.</span>
<span class="sd">  This is mainly used for declaring input fields when defining a topology, and internally</span>
<span class="sd">  in HeronComponentSpec.</span>

<span class="sd">  Note that topology writers never have to create an instance of this class by themselves,</span>
<span class="sd">  as it is created automatically.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">componentId</span><span class="p">,</span> <span class="n">streamId</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :type componentId: str or HeronComponentSpec</span>
<span class="sd">    :param componentId: component id from which the tuple is emitted, or HeronComponentSpec object.</span>
<span class="sd">    :type streamId: str</span>
<span class="sd">    :param streamId: stream id through which the tuple is transmitted</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">componentId</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;GlobalStreamId: componentId must be either string or HeronComponentSpec&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">streamId</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;GlobalStreamId: streamId must be string type&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span> <span class="o">=</span> <span class="n">componentId</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span> <span class="o">=</span> <span class="n">streamId</span>

  <span class="nd">@property</span>
  <span class="k">def</span> <span class="nf">component_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns component_id of this GlobalStreamId</span>

<span class="sd">    Note that if HeronComponentSpec is specified as componentId and its name is not yet</span>
<span class="sd">    available (i.e. when ``name`` argument was not given in ``spec()`` method in Bolt or Spout),</span>
<span class="sd">    this property returns a message with uuid. However, this is provided only for safety</span>
<span class="sd">    with __eq__(), __str__(), and __hash__() methods, and not meant to be called explicitly</span>
<span class="sd">    before TopologyType class finally sets the name attribute of HeronComponentSpec.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># HeronComponentSpec instance&#39;s name attribute might not be available until</span>
        <span class="c1"># TopologyType metaclass finally sets it. This statement is to support __eq__(),</span>
        <span class="c1"># __hash__() and __str__() methods with safety, as raising Exception is not</span>
        <span class="c1"># appropriate this case.</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;No name available for HeronComponentSpec yet, uuid: </span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="o">.</span><span class="n">uuid</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="o">.</span><span class="n">name</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Component Id for this GlobalStreamId is not properly set: &lt;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&gt;&quot;</span>
                       <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span><span class="p">)))</span>

  <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;component_id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">component_id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">component_id</span> \
           <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;stream_id&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">stream_id</span>

  <span class="k">def</span> <span class="nf">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__str__</span><span class="p">())</span>

  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">component_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#heronpy.api.component.component_spec.GlobalStreamId">GlobalStreamId</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="heronpy.api.component.component_spec.GlobalStreamId.component_id" class="name">var <span class="ident">component_id</span></p>
            

            
  
    <div class="desc"><p>Returns component_id of this GlobalStreamId</p>
<p>Note that if HeronComponentSpec is specified as componentId and its name is not yet
available (i.e. when <code>name</code> argument was not given in <code>spec()</code> method in Bolt or Spout),
this property returns a message with uuid. However, this is provided only for safety
with <strong>eq</strong>(), <strong>str</strong>(), and <strong>hash</strong>() methods, and not meant to be called explicitly
before TopologyType class finally sets the name attribute of HeronComponentSpec.</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="heronpy.api.component.component_spec.GlobalStreamId.stream_id" class="name">var <span class="ident">stream_id</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="heronpy.api.component.component_spec.GlobalStreamId.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, componentId, streamId)</p>
    </div>
    

    
  
    <div class="desc"><p>:type componentId: str or HeronComponentSpec
:param componentId: component id from which the tuple is emitted, or HeronComponentSpec object.
:type streamId: str
:param streamId: stream id through which the tuple is transmitted</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-heronpy.api.component.component_spec.GlobalStreamId.__init__', this);">Show source &equiv;</a></p>
  <div id="source-heronpy.api.component.component_spec.GlobalStreamId.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">componentId</span><span class="p">,</span> <span class="n">streamId</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  :type componentId: str or HeronComponentSpec</span>
<span class="sd">  :param componentId: component id from which the tuple is emitted, or HeronComponentSpec object.</span>
<span class="sd">  :type streamId: str</span>
<span class="sd">  :param streamId: stream id through which the tuple is transmitted</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">componentId</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;GlobalStreamId: componentId must be either string or HeronComponentSpec&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">streamId</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;GlobalStreamId: streamId must be string type&#39;</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">_component_id</span> <span class="o">=</span> <span class="n">componentId</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">stream_id</span> <span class="o">=</span> <span class="n">streamId</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="heronpy.api.component.component_spec.HeronComponentSpec" class="name">class <span class="ident">HeronComponentSpec</span></p>
      
  
    <div class="desc"><p>Class to specify the information and location of components in a topology</p>
<p>This class is generated by the <code>spec()</code> method of Spout and Bolt class and
specifies how this component is located in the topology and how it is connected to
the other components. This class also retains the Python class path of the component,
so pex_loader can load the component appropriately.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-heronpy.api.component.component_spec.HeronComponentSpec', this);">Show source &equiv;</a></p>
  <div id="source-heronpy.api.component.component_spec.HeronComponentSpec" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">HeronComponentSpec</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Class to specify the information and location of components in a topology</span>

<span class="sd">  This class is generated by the ``spec()`` method of Spout and Bolt class and</span>
<span class="sd">  specifies how this component is located in the topology and how it is connected to</span>
<span class="sd">  the other components. This class also retains the Python class path of the component,</span>
<span class="sd">  so pex_loader can load the component appropriately.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">python_class_path</span><span class="p">,</span> <span class="n">is_spout</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span>
               <span class="n">inputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_args</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">python_class_path</span><span class="p">,</span> <span class="n">is_spout</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">python_class_path</span> <span class="o">=</span> <span class="n">python_class_path</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_spout</span> <span class="o">=</span> <span class="n">is_spout</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parallelism</span> <span class="o">=</span> <span class="n">par</span>

    <span class="c1"># inputs, outputs, config will be sanitized later</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">custom_config</span> <span class="o">=</span> <span class="n">config</span>

    <span class="c1"># This is used for identification, especially when name is not specified by argument</span>
    <span class="c1"># Note that ``self.name`` might not be available until it is set by TopologyType metaclass</span>
    <span class="c1"># so this is necessary for identification purposes. Used mainly by GlobalStreamId.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">_sanitize_args</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">py_class_path</span><span class="p">,</span> <span class="n">is_spout</span><span class="p">,</span> <span class="n">par</span><span class="p">):</span>
    <span class="c1"># name can be None at the time this spec is initialized</span>
    <span class="k">assert</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">py_class_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">is_spout</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">par</span> <span class="o">&gt;</span> <span class="mi">0</span>

  <span class="k">def</span> <span class="nf">get_protobuf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns protobuf message (Spout or Bolt) of this component&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spout</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spout</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bolt</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">_get_spout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns Spout protobuf message&quot;&quot;&quot;</span>
    <span class="n">spout</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Spout</span><span class="p">()</span>
    <span class="n">spout</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_base_component</span><span class="p">())</span>

    <span class="c1"># Add output streams</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_out_streams</span><span class="p">(</span><span class="n">spout</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">spout</span>

  <span class="k">def</span> <span class="nf">_get_bolt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns Bolt protobuf message&quot;&quot;&quot;</span>
    <span class="n">bolt</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Bolt</span><span class="p">()</span>
    <span class="n">bolt</span><span class="o">.</span><span class="n">comp</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_base_component</span><span class="p">())</span>

    <span class="c1"># Add streams</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_in_streams</span><span class="p">(</span><span class="n">bolt</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add_out_streams</span><span class="p">(</span><span class="n">bolt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bolt</span>

  <span class="k">def</span> <span class="nf">_get_base_component</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns Component protobuf message&quot;&quot;&quot;</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Component</span><span class="p">()</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">spec</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">ComponentObjectSpec</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;PYTHON_CLASS_NAME&quot;</span><span class="p">)</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">python_class_path</span>
    <span class="n">comp</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_comp_config</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">comp</span>

  <span class="k">def</span> <span class="nf">_get_comp_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns component-specific Config protobuf message</span>

<span class="sd">    It first adds ``topology.component.parallelism``, and is overriden by</span>
<span class="sd">    a user-defined component-specific configuration, specified by spec().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proto_config</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Config</span><span class="p">()</span>

    <span class="c1"># first add parallelism</span>
    <span class="n">key</span> <span class="o">=</span> <span class="n">proto_config</span><span class="o">.</span><span class="n">kvs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
    <span class="n">key</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">TOPOLOGY_COMPONENT_PARALLELISM</span>
    <span class="n">key</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parallelism</span><span class="p">)</span>
    <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">ConfigValueType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;STRING_VALUE&quot;</span><span class="p">)</span>

    <span class="c1"># iterate through self.custom_config</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">custom_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">sanitized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">custom_config</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sanitized</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
          <span class="n">kvs</span> <span class="o">=</span> <span class="n">proto_config</span><span class="o">.</span><span class="n">kvs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">ConfigValueType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;STRING_VALUE&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="c1"># need to serialize</span>
          <span class="n">kvs</span> <span class="o">=</span> <span class="n">proto_config</span><span class="o">.</span><span class="n">kvs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">serialized_value</span> <span class="o">=</span> <span class="n">default_serializer</span><span class="o">.</span><span class="n">serialize</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
          <span class="n">kvs</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">ConfigValueType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;PYTHON_SERIALIZED_VALUE&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">proto_config</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">_sanitize_config</span><span class="p">(</span><span class="n">custom_config</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks whether ``custom_config`` is sane and returns a sanitized dict &lt;str -&gt; (str|object)&gt;</span>

<span class="sd">    It checks if keys are all strings and sanitizes values of a given dictionary as follows:</span>

<span class="sd">    - If string, number or boolean is given as a value, it is converted to string.</span>
<span class="sd">      For string and number (int, float), it is converted to string by a built-in ``str()`` method.</span>
<span class="sd">      For a boolean value, ``True`` is converted to &quot;true&quot; instead of &quot;True&quot;, and ``False`` is</span>
<span class="sd">      converted to &quot;false&quot; instead of &quot;False&quot;, in order to keep the consistency with</span>
<span class="sd">      Java configuration.</span>

<span class="sd">    - If neither of the above is given as a value, it is inserted into the sanitized dict as it is.</span>
<span class="sd">      These values will need to be serialized before adding to a protobuf message.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">custom_config</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Component-specific configuration must be given as a dict type, given: </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">custom_config</span><span class="p">)))</span>
    <span class="n">sanitized</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">custom_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Key for component-specific configuration must be string, given: </span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)))</span>

      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="n">sanitized</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
        <span class="n">sanitized</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">sanitized</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">sanitized</span>

  <span class="k">def</span> <span class="nf">_add_in_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bolt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds inputs to a given protobuf Bolt message&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>
    <span class="c1"># sanitize inputs and get a map &lt;GlobalStreamId -&gt; Grouping&gt;</span>
    <span class="n">input_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_inputs</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">global_streamid</span><span class="p">,</span> <span class="n">gtype</span> <span class="ow">in</span> <span class="n">input_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="n">in_stream</span> <span class="o">=</span> <span class="n">bolt</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
      <span class="n">in_stream</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stream_id</span><span class="p">(</span><span class="n">global_streamid</span><span class="o">.</span><span class="n">component_id</span><span class="p">,</span>
                                                    <span class="n">global_streamid</span><span class="o">.</span><span class="n">stream_id</span><span class="p">))</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gtype</span><span class="p">,</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">FIELDS</span><span class="p">):</span>
        <span class="c1"># it&#39;s a field grouping</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">gtype</span> <span class="o">=</span> <span class="n">gtype</span><span class="o">.</span><span class="n">gtype</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">grouping_fields</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stream_schema</span><span class="p">(</span><span class="n">gtype</span><span class="o">.</span><span class="n">fields</span><span class="p">))</span>
      <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gtype</span><span class="p">,</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">):</span>
        <span class="c1"># it&#39;s a custom grouping</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">gtype</span> <span class="o">=</span> <span class="n">gtype</span><span class="o">.</span><span class="n">gtype</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">custom_grouping_object</span> <span class="o">=</span> <span class="n">gtype</span><span class="o">.</span><span class="n">python_serialized</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">CustomGroupingObjectType</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;PYTHON_OBJECT&quot;</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">in_stream</span><span class="o">.</span><span class="n">gtype</span> <span class="o">=</span> <span class="n">gtype</span>

  <span class="c1"># pylint: disable=too-many-branches</span>
  <span class="k">def</span> <span class="nf">_sanitize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sanitizes input fields and returns a map &lt;GlobalStreamId -&gt; Grouping&gt;&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
      <span class="c1"># inputs are dictionary, must be either &lt;HeronComponentSpec -&gt; Grouping&gt; or</span>
      <span class="c1"># &lt;GlobalStreamId -&gt; Grouping&gt;</span>
      <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">grouping</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">is_grouping_sane</span><span class="p">(</span><span class="n">grouping</span><span class="p">):</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;A given grouping is not supported&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">):</span>
          <span class="c1"># use default streamid</span>
          <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># should not happen as TopologyType metaclass sets name attribute</span>
            <span class="c1"># before calling this method</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;In _sanitize_inputs(): HeronComponentSpec doesn&#39;t have a name&quot;</span><span class="p">)</span>
          <span class="n">global_streamid</span> <span class="o">=</span> <span class="n">GlobalStreamId</span><span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">)</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">global_streamid</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouping</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">GlobalStreamId</span><span class="p">):</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">grouping</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not supported as a key to inputs&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="c1"># inputs are lists, must be either a list of HeronComponentSpec or GlobalStreamId</span>
      <span class="c1"># will use SHUFFLE grouping</span>
      <span class="k">for</span> <span class="n">input_obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_obj</span><span class="p">,</span> <span class="n">HeronComponentSpec</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">input_obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># should not happen as TopologyType metaclass sets name attribute</span>
            <span class="c1"># before calling this method</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;In _sanitize_inputs(): HeronComponentSpec doesn&#39;t have a name&quot;</span><span class="p">)</span>
          <span class="n">global_streamid</span> <span class="o">=</span> <span class="n">GlobalStreamId</span><span class="p">(</span><span class="n">input_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">)</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">global_streamid</span><span class="p">]</span> <span class="o">=</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">SHUFFLE</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_obj</span><span class="p">,</span> <span class="n">GlobalStreamId</span><span class="p">):</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">input_obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">Grouping</span><span class="o">.</span><span class="n">SHUFFLE</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not supported as an input&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_obj</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Inputs must be a list, dict, or None, given: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ret</span>

  <span class="k">def</span> <span class="nf">_add_out_streams</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spbl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds outputs to a given protobuf Bolt or Spout message&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="c1"># sanitize outputs and get a map &lt;stream_id -&gt; out fields&gt;</span>
    <span class="n">output_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_outputs</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">out_fields</span> <span class="ow">in</span> <span class="n">output_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="n">out_stream</span> <span class="o">=</span> <span class="n">spbl</span><span class="o">.</span><span class="n">outputs</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
      <span class="n">out_stream</span><span class="o">.</span><span class="n">stream</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stream_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">))</span>
      <span class="n">out_stream</span><span class="o">.</span><span class="n">schema</span><span class="o">.</span><span class="n">CopyFrom</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_stream_schema</span><span class="p">(</span><span class="n">out_fields</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">_sanitize_outputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Sanitizes output fields and returns a map &lt;stream_id -&gt; list of output fields&gt;&quot;&quot;&quot;</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument to outputs must be either list or tuple, given: </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Outputs must be a list of strings or Streams, given: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># it&#39;s a default stream</span>
        <span class="k">if</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">ret</span><span class="p">[</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="c1"># output is a Stream object</span>
        <span class="k">if</span> <span class="n">output</span><span class="o">.</span><span class="n">stream_id</span> <span class="o">==</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="ow">and</span> <span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="ow">in</span> <span class="n">ret</span><span class="p">:</span>
          <span class="c1"># some default stream fields are already in there</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">ret</span><span class="p">[</span><span class="n">output</span><span class="o">.</span><span class="n">stream_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">fields</span>
    <span class="k">return</span> <span class="n">ret</span>

  <span class="k">def</span> <span class="nf">get_out_streamids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a set of output stream ids registered for this component&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument to outputs must be either list or tuple, given: </span><span class="si">%s</span><span class="s2">&quot;</span>
                      <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)))</span>
    <span class="n">ret_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Outputs must be a list of strings or Streams, given: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
      <span class="n">ret_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">stream_id</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">ret_lst</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get GlobalStreamId for a given stream_id&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">stream_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_out_streamids</span><span class="p">():</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A given stream id does not exist on this component: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">stream_id</span><span class="p">)</span>

    <span class="n">component_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span>
    <span class="k">return</span> <span class="n">GlobalStreamId</span><span class="p">(</span><span class="n">componentId</span><span class="o">=</span><span class="n">component_id</span><span class="p">,</span> <span class="n">streamId</span><span class="o">=</span><span class="n">stream_id</span><span class="p">)</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">_get_stream_id</span><span class="p">(</span><span class="n">comp_name</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a StreamId protobuf message&quot;&quot;&quot;</span>
    <span class="n">proto_stream_id</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">StreamId</span><span class="p">()</span>
    <span class="n">proto_stream_id</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">stream_id</span>
    <span class="n">proto_stream_id</span><span class="o">.</span><span class="n">component_name</span> <span class="o">=</span> <span class="n">comp_name</span>
    <span class="k">return</span> <span class="n">proto_stream_id</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">_get_stream_schema</span><span class="p">(</span><span class="n">fields</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns a StreamSchema protobuf message&quot;&quot;&quot;</span>
    <span class="n">stream_schema</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">StreamSchema</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
      <span class="n">key</span> <span class="o">=</span> <span class="n">stream_schema</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
      <span class="n">key</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">field</span>
      <span class="n">key</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">topology_pb2</span><span class="o">.</span><span class="n">Type</span><span class="o">.</span><span class="n">Value</span><span class="p">(</span><span class="s2">&quot;OBJECT&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stream_schema</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#heronpy.api.component.component_spec.HeronComponentSpec">HeronComponentSpec</a></li>
          <li>__builtin__.object</li>
          </ul>
          <h3>Instance variables</h3>
            <div class="item">
            <p id="heronpy.api.component.component_spec.HeronComponentSpec.custom_config" class="name">var <span class="ident">custom_config</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="heronpy.api.component.component_spec.HeronComponentSpec.inputs" class="name">var <span class="ident">inputs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="heronpy.api.component.component_spec.HeronComponentSpec.is_spout" class="name">var <span class="ident">is_spout</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="heronpy.api.component.component_spec.HeronComponentSpec.name" class="name">var <span class="ident">name</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="heronpy.api.component.component_spec.HeronComponentSpec.outputs" class="name">var <span class="ident">outputs</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="heronpy.api.component.component_spec.HeronComponentSpec.parallelism" class="name">var <span class="ident">parallelism</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="heronpy.api.component.component_spec.HeronComponentSpec.python_class_path" class="name">var <span class="ident">python_class_path</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="heronpy.api.component.component_spec.HeronComponentSpec.uuid" class="name">var <span class="ident">uuid</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
          <h3>Methods</h3>
            
  <div class="item">
    <div class="name def" id="heronpy.api.component.component_spec.HeronComponentSpec.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name, python_class_path, is_spout, par, inputs=None, outputs=None, config=None)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-heronpy.api.component.component_spec.HeronComponentSpec.__init__', this);">Show source &equiv;</a></p>
  <div id="source-heronpy.api.component.component_spec.HeronComponentSpec.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">python_class_path</span><span class="p">,</span> <span class="n">is_spout</span><span class="p">,</span> <span class="n">par</span><span class="p">,</span>
             <span class="n">inputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">_sanitize_args</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">python_class_path</span><span class="p">,</span> <span class="n">is_spout</span><span class="p">,</span> <span class="n">par</span><span class="p">)</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">python_class_path</span> <span class="o">=</span> <span class="n">python_class_path</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">is_spout</span> <span class="o">=</span> <span class="n">is_spout</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">parallelism</span> <span class="o">=</span> <span class="n">par</span>
  <span class="c1"># inputs, outputs, config will be sanitized later</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">custom_config</span> <span class="o">=</span> <span class="n">config</span>
  <span class="c1"># This is used for identification, especially when name is not specified by argument</span>
  <span class="c1"># Note that ``self.name`` might not be available until it is set by TopologyType metaclass</span>
  <span class="c1"># so this is necessary for identification purposes. Used mainly by GlobalStreamId.</span>
  <span class="bp">self</span><span class="o">.</span><span class="n">uuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="heronpy.api.component.component_spec.HeronComponentSpec.get_out_streamids">
    <p>def <span class="ident">get_out_streamids</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns a set of output stream ids registered for this component</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-heronpy.api.component.component_spec.HeronComponentSpec.get_out_streamids', this);">Show source &equiv;</a></p>
  <div id="source-heronpy.api.component.component_spec.HeronComponentSpec.get_out_streamids" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_out_streamids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Returns a set of output stream ids registered for this component&quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument to outputs must be either list or tuple, given: </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">)))</span>
  <span class="n">ret_lst</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">output</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">outputs</span><span class="p">:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Stream</span><span class="p">)):</span>
      <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Outputs must be a list of strings or Streams, given: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>
    <span class="n">ret_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Stream</span><span class="o">.</span><span class="n">DEFAULT_STREAM_ID</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">output</span><span class="o">.</span><span class="n">stream_id</span><span class="p">)</span>
  <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">ret_lst</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="heronpy.api.component.component_spec.HeronComponentSpec.get_protobuf">
    <p>def <span class="ident">get_protobuf</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns protobuf message (Spout or Bolt) of this component</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-heronpy.api.component.component_spec.HeronComponentSpec.get_protobuf', this);">Show source &equiv;</a></p>
  <div id="source-heronpy.api.component.component_spec.HeronComponentSpec.get_protobuf" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_protobuf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Returns protobuf message (Spout or Bolt) of this component&quot;&quot;&quot;</span>
  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_spout</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_spout</span><span class="p">()</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bolt</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>
