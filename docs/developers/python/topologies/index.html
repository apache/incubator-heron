<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="/heron/img/favicon-16x16.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="/heron/img/favicon-32x32.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.16" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="Heron"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="/heron"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@heronstreaming"><meta name="twitter:title" content="Heron"><meta name="twitter:image" content=""><meta property="og:site_name" content="Writing and Launching a Topology in Python"><meta property="og:url" content=""><meta property="og:description" content=""><meta name="twitter:description" content=""><title>Heron Documentation - Writing and Launching a Topology in Python</title><link rel="stylesheet" href="/heron/css/style.min.css"><link rel="stylesheet" href="/heron/css/font-awesome.min.css"><link rel="stylesheet" href="/heron/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="/heron/"><img class="pull-left" src="/heron/img/HeronTextLogo-small.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="/heron/docs/getting-started">Docs</a></li><li><a href="/heron/api">API</a></li><li><a href="/heron/docs/resources">Resources</a></li><li><a href="/heron/docs/contributors/community">Community</a></li><li><a href="https://github.com/twitter/heron">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/heron-users">Mailing List</a></li><li><a class="nav-icon" href="https://twitter.com/heronstreaming"><i class="fa fa-twitter"></i></a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="getting-started" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-getting-started" aria-labelledby="getting-started"><i class="fa fa-caret-right"></i>Getting Started</a></h4></section><div id="collapse-getting-started" class="panel-collapse collapse" aria-labelledby="getting-started"><div class="panel-body"><ul><li><a href="/heron/docs/getting-started">Local (Single Node)</a></li><li><a href="/heron/docs/upgrade-storm-to-heron">Upgrade Storm Topologies</a></li><li><a href="/heron/docs/getting-started-troubleshooting">Troubleshooting Guide</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-concepts" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-concepts" aria-labelledby="heron-concepts"><i class="fa fa-caret-right"></i>Heron Concepts</a></h4></section><div id="collapse-heron-concepts" class="panel-collapse collapse" aria-labelledby="heron-concepts"><div class="panel-body"><ul><li><a href="/heron/docs/concepts/design-goals">Heron Design Goals</a></li><li><a href="/heron/docs/concepts/topologies">Heron Topology</a></li><li><a href="/heron/docs/concepts/architecture">Heron Architecture</a></li></ul></div></div></div><div class="panel panel-default"><section id="deployment" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-deployment" aria-labelledby="deployment"><i class="fa fa-caret-right"></i>Deployment</a></h4></section><div id="collapse-deployment" class="panel-collapse collapse" aria-labelledby="deployment"><div class="panel-body"><ul><li><a href="/heron/docs/operators/deployment">Overview</a></li><li><a href="/heron/docs/operators/deployment/configuration">Configuration</a></li></ul></div></div></div><div class="panel panel-default"><section id="state-managers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-state-managers" aria-labelledby="state-managers"><i class="fa fa-caret-right"></i>State Managers</a></h4></section><div id="collapse-state-managers" class="panel-collapse collapse" aria-labelledby="state-managers"><div class="panel-body"><ul><li><a href="/heron/docs/operators/deployment/statemanagers/zookeeper">Zookeeper</a></li><li><a href="/heron/docs/operators/deployment/statemanagers/localfs">Local FS</a></li></ul></div></div></div><div class="panel panel-default"><section id="uploaders" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-uploaders" aria-labelledby="uploaders"><i class="fa fa-caret-right"></i>Uploaders</a></h4></section><div id="collapse-uploaders" class="panel-collapse collapse" aria-labelledby="uploaders"><div class="panel-body"><ul><li><a href="/heron/docs/operators/deployment/uploaders/localfs">Local FS</a></li><li><a href="/heron/docs/operators/deployment/uploaders/hdfs">HDFS</a></li><li><a href="/heron/docs/operators/deployment/uploaders/s3">Amazon S3</a></li><li><a href="/heron/docs/operators/deployment/uploaders/scp">Secure Copy (SCP)</a></li></ul></div></div></div><div class="panel panel-default"><section id="schedulers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-schedulers" aria-labelledby="schedulers"><i class="fa fa-caret-right"></i>Schedulers</a></h4></section><div id="collapse-schedulers" class="panel-collapse collapse" aria-labelledby="schedulers"><div class="panel-body"><ul><li><a href="/heron/docs/operators/deployment/schedulers/aurora">Aurora Cluster</a></li><li><a href="/heron/docs/operators/deployment/schedulers/local">Local Cluster</a></li><li><a href="/heron/docs/operators/deployment/schedulers/mesos-local-mac">Mesos Cluster Locally</a></li><li><a href="/heron/docs/operators/deployment/schedulers/slurm">Slurm Cluster</a></li><li><a href="/heron/docs/operators/deployment/schedulers/yarn">YARN Cluster</a></li></ul></div></div></div><div class="panel panel-default"><section id="cluster-configuration" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-cluster-configuration" aria-labelledby="cluster-configuration"><i class="fa fa-caret-right"></i>Cluster Configuration</a></h4></section><div id="collapse-cluster-configuration" class="panel-collapse collapse" aria-labelledby="cluster-configuration"><div class="panel-body"><ul><li><a href="/heron/docs/operators/configuration/config-intro">Overview</a></li><li><a href="/heron/docs/operators/configuration/system">System-Level</a></li><li><a href="/heron/docs/operators/configuration/instance">Heron Instance</a></li><li><a href="/heron/docs/operators/configuration/metrics-manager">Metrics Manager</a></li><li><a href="/heron/docs/operators/configuration/stmgr">Stream Manager</a></li><li><a href="/heron/docs/operators/configuration/tmaster">Topology Master</a></li></ul></div></div></div><div class="panel panel-default"><section id="observability" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-observability" aria-labelledby="observability"><i class="fa fa-caret-right"></i>Observability</a></h4></section><div id="collapse-observability" class="panel-collapse collapse" aria-labelledby="observability"><div class="panel-body"><ul><li><a href="/heron/docs/operators/observability/graphite">Graphite</a></li></ul></div></div></div><div class="panel panel-default"><section id="user-manuals" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-user-manuals" aria-labelledby="user-manuals"><i class="fa fa-caret-right"></i>User Manuals</a></h4></section><div id="collapse-user-manuals" class="panel-collapse collapse" aria-labelledby="user-manuals"><div class="panel-body"><ul><li><a href="/heron/docs/operators/heron-cli">Heron Client</a></li><li><a href="/heron/docs/operators/heron-tracker-api">Heron Tracker REST API</a></li><li><a href="/heron/docs/operators/heron-tracker">Heron Tracker Runbook</a></li><li><a href="/heron/docs/operators/heron-ui">Heron UI Runbook</a></li></ul></div></div></div><div class="panel panel-default"><section id="topology-writers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-topology-writers" aria-labelledby="topology-writers"><i class="fa fa-caret-right"></i>Topology Writers</a></h4></section><div id="collapse-topology-writers" class="panel-collapse collapse" aria-labelledby="topology-writers"><div class="panel-body"><ul><li><a href="/heron/docs/developers/java/topologies">Writing Java Topologies</a></li><li><a href="/heron/docs/developers/python/topologies">Writing Python Topologies</a></li><li><a href="/heron/docs/developers/data-model">Heron Data Model</a></li><li><a href="/heron/docs/developers/serialization">Tuple Serialization</a></li><li><a href="/heron/docs/developers/ui-guide">Heron UI Guide</a></li><li><a href="/heron/docs/developers/tuning">Tuning Guide</a></li><li><a href="/heron/docs/developers/packing/ffdpacking">Packing Algorithms</a></li><li><a href="/heron/docs/developers/simulator-mode">Simulator Mode</a></li><li><a href="/heron/docs/developers/troubleshooting">Troubleshooting Guide</a></li><li><a href="/heron/api">Javadoc</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-developers" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-developers" aria-labelledby="heron-developers"><i class="fa fa-caret-right"></i>Heron Developers</a></h4></section><div id="collapse-heron-developers" class="panel-collapse collapse" aria-labelledby="heron-developers"><div class="panel-body"><ul><li><a href="/heron/docs/developers/compiling/compiling">Compiling</a></li><li><a href="/heron/docs/developers/compiling/linux">Compiling on Linux</a></li><li><a href="/heron/docs/developers/compiling/mac">Compiling on Mac OS X</a></li><li><a href="/heron/docs/developers/compiling/docker">Compiling With Docker</a></li><li><a href="/heron/docs/contributors/testing">Running Tests</a></li><li><a href="/heron/docs/contributors/codebase">Code Organization</a></li></ul></div></div></div><div class="panel panel-default"><section id="extending-heron" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-extending-heron" aria-labelledby="extending-heron"><i class="fa fa-caret-right"></i>Extending Heron</a></h4></section><div id="collapse-extending-heron" class="panel-collapse collapse" aria-labelledby="extending-heron"><div class="panel-body"><ul><li><a href="/heron/docs/contributors/custom-scheduler">Custom Scheduler</a></li><li><a href="/heron/docs/contributors/custom-metrics-sink">Custom Metrics Sink</a></li></ul></div></div></div><div class="panel panel-default"><section id="heron-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-heron-resources" aria-labelledby="heron-resources"><i class="fa fa-caret-right"></i>Heron Resources</a></h4></section><div id="collapse-heron-resources" class="panel-collapse collapse" aria-labelledby="heron-resources"><div class="panel-body"><ul><li><a href="/heron/docs/resources">Heron Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="/heron/docs/contributors/community">Community</a></li><li><a href="/heron/docs/contributors/governance">Governance</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Writing and Launching a Topology in Python</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p>Currently, support for developing a Heron topology in Python is still experimental.
It is compatible with the Streamparse API, so Python topologies written
for the Streamparse can be deployed on Heron with ease.
This page describes how to write and launch a topology in Python, as well as
how to convert a Streamparse topology to a PyHeron topology.</p>

<p>Note that a Python topology is known to be approximately 20-40 times slower
than a topology written in Java. This performance issue will be resolved in later releases.</p>

<p>You need to first download <code>PyHeron</code> library and include it in your project.</p>

<h1 id="writing-your-own-topology-in-python">Writing your own topology in Python</h1>

<p><a href="../spouts">Spouts</a> and <a href="../bolts">Bolts</a> discuss how to implement spouts and
bolts in Python, respectively.</p>

<p>After defining the spouts and bolts, a topology can be composed by two ways:</p>

<ul>
<li>Using <code>TopologyBuilder</code> (not compatible with the Streamparse API)</li>
<li>Subclassing <code>Topology</code> class (compatible with the Streamparse API)</li>
</ul>

<h2 id="defining-a-topology-using-a-topologybuilder">Defining a topology using a TopologyBuilder</h2>

<p>This way of defining a topology is similar to defining a topology in Java,
and is not compatible with the Streamparse API.</p>

<p>The <code>TopologyBuilder</code> has two major methods to specify the components:</p>

<ul>
<li><p><code>add_spout(self, name, spout_cls, par, config=None)</code></p>

<ul>
<li><code>name</code> is <code>str</code> specifying the unique identifier that is assigned to this spout.</li>
<li><code>spout_cls</code> is a subclass of <code>Spout</code> that defines this spout.</li>
<li><code>par</code> is <code>int</code> specifying the number of instances of this spout.</li>
<li><code>config</code> is <code>dict</code> specifying this spout-specific configuration.</li>
</ul></li>

<li><p><code>add_bolt(self, name, bolt_cls, par, inputs, config=None)</code></p>

<ul>
<li><code>name</code> is <code>str</code> specifying the unique identifier that is assigned to this bolt.</li>
<li><code>bolt_cls</code> is a subclass of <code>Bolt</code> that defines this bolt.</li>
<li><code>par</code> is <code>int</code> specifying the number of instances of this bolt.</li>
<li><code>inputs</code> is either <code>dict</code> mapping from <code>HeronComponentSpec</code> to <code>Grouping</code>;
or <code>list</code> of <code>HeronComponentSpec</code>, in which case the shuffle grouping is used.</li>
<li><code>config</code> is <code>dict</code> specifying this bolt-specific configuration.</li>
</ul></li>
</ul>

<p>Each method returns the corresponding <code>HeronComponentSpec</code> object.</p>

<p>The following is an example implementation of WordCountTopology in Python.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">from</span> <span style="color: #f8f8f2">pyheron</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">TopologyBuilder</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">your_spout</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">WordSpout</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">your_bolt</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">CountBolt</span>

<span style="color: #66d9ef">if</span> <span style="color: #f8f8f2">__name__</span> <span style="color: #f92672">==</span> <span style="color: #e6db74">&quot;__main__&quot;</span><span style="color: #f8f8f2">:</span>
  <span style="color: #f8f8f2">builder</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">TopologyBuilder(</span><span style="color: #e6db74">&quot;WordCountTopology&quot;</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">word_spout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">builder</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">add_spout(</span><span style="color: #e6db74">&quot;word_spout&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">WordSpout,</span> <span style="color: #f8f8f2">par</span><span style="color: #f92672">=</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">count_bolt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">builder</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">add_bolt(</span><span style="color: #e6db74">&quot;count_bolt&quot;</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">CountBolt,</span> <span style="color: #f8f8f2">par</span><span style="color: #f92672">=</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span>
                                <span style="color: #f8f8f2">inputs</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">{word_spout:</span> <span style="color: #f8f8f2">Grouping</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">fields(</span><span style="color: #e6db74">&#39;word&#39;</span><span style="color: #f8f8f2">)})</span>
  <span style="color: #f8f8f2">builder</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">build_and_submit()</span>
</pre></div>

<p>Note that arguments to the main method can be passed by providing them in the
<code>heron submit</code> command.</p>

<h2 id="defining-a-topology-by-subclassing-topology-class">Defining a topology by subclassing Topology class</h2>

<p>This way of defining a topology is compatible with the Streamparse API.
All you need to do is to place <code>HeronComponentSpec</code> as the class attributes
of your topology class, which are returned by the <code>spec()</code> method of
your spout or bolt class.</p>

<ul>
<li><p><code>Spout.spec(cls, name=None, par=1, config=None)</code></p>

<ul>
<li><code>name</code> is either <code>str</code> specifying the unique identifier that is assigned to this spout, or
<code>None</code> if you want to use the variable name of the returned <code>HeronComponentSpec</code> as
the unique identifier for this spout.</li>
<li><code>par</code> is <code>int</code> specifying the number of instances of this spout.</li>
<li><code>config</code> is <code>dict</code> specifying this spout-specific configuration.</li>
</ul></li>

<li><p><code>Bolt.spec(cls, name=None, inputs=None, par=1, config=None)</code></p>

<ul>
<li><code>name</code> is either <code>str</code> specifying the unique identifier that is assigned to this bolt; or
<code>None</code> if you want to use the variable name of the returned <code>HeronComponentSpec</code> as
the unique identifier for this bolt.</li>
<li><code>inputs</code> is either <code>dict</code> mapping from <code>HeronComponentSpec</code> to <code>Grouping</code>;
or <code>list</code> of <code>HeronComponentSpec</code>, in which case the shuffle grouping is used.</li>
<li><code>par</code> is <code>int</code> specifying the number of instances of this bolt.</li>
<li><code>config</code> is <code>dict</code> specifying this bolt-specific configuration.</li>
</ul></li>
</ul>

<p>The same WordCountTopology is defined in the following manner.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f92672">from</span> <span style="color: #f8f8f2">pyheron</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">Topology</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">your_spout</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">WordSpout</span>
<span style="color: #f92672">from</span> <span style="color: #f8f8f2">your_bolt</span> <span style="color: #f92672">import</span> <span style="color: #f8f8f2">CountBolt</span>

<span style="color: #66d9ef">class</span> <span style="color: #a6e22e">WordCount</span><span style="color: #f8f8f2">(Topology):</span>
  <span style="color: #f8f8f2">word_spout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">WordSpout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">spec(par</span><span style="color: #f92672">=</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">)</span>
  <span style="color: #f8f8f2">count_bolt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">CountBolt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">spec(par</span><span style="color: #f92672">=</span><span style="color: #ae81ff">2</span><span style="color: #f8f8f2">,</span> <span style="color: #f8f8f2">inputs</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">{word_spout:</span> <span style="color: #f8f8f2">Grouping</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">fields(</span><span style="color: #e6db74">&#39;word&#39;</span><span style="color: #f8f8f2">)})</span>
</pre></div>

<h2 id="topology-wide-configuration">Topology-wide configuration</h2>

<p>Topology-wide configuration can be specified by using <code>set_config()</code> method if
you are using <code>TopologyBuilder</code>, or by placing <code>config</code> containing <code>dict</code>
as the class attribute of your topology. Note that these configuration will be
overriden by component-specific configuration at runtime</p>

<h2 id="multiple-streams">Multiple streams</h2>

<p>To specify that a component has multiple output streams, instead of using a list of
strings for <code>outputs</code>, you can specify a list of <code>Stream</code> objects, in the following manner.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">MultiStreamSpout</span><span style="color: #f8f8f2">(Spout):</span>
  <span style="color: #f8f8f2">outputs</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">[Stream(fields</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;normal&#39;</span><span style="color: #f8f8f2">,</span> <span style="color: #e6db74">&#39;fields&#39;</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">name</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;default&#39;</span><span style="color: #f8f8f2">),</span>
             <span style="color: #f8f8f2">Stream(fields</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;error_message&#39;</span><span style="color: #f8f8f2">],</span> <span style="color: #f8f8f2">name</span><span style="color: #f92672">=</span><span style="color: #e6db74">&#39;error_stream&#39;</span><span style="color: #f8f8f2">)]</span>
</pre></div>

<p>To select one of these streams as the input for your bolt, you can simply
use <code>[]</code> to specify the stream you want. Without any stream specified, the <code>default</code>
stream will be used.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">MultiStreamTopology</span><span style="color: #f8f8f2">(Topology):</span>
  <span style="color: #f8f8f2">spout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">MultiStreamSpout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">spec()</span>
  <span style="color: #f8f8f2">error_bolt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ErrorBolt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">spec(inputs</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">{spout[</span><span style="color: #e6db74">&#39;error_stream&#39;</span><span style="color: #f8f8f2">]:</span> <span style="color: #f8f8f2">Grouping</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">LOWEST})</span>
  <span style="color: #f8f8f2">consume_bolt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ConsumeBolt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">spec(inputs</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">{spout:</span> <span style="color: #f8f8f2">Grouping</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">SHUFFLE})</span>
</pre></div>

<p>For further information about the API, refer to the Streamparse API documentation,
although there are some methods and functionalities that are not supported or
are invalid in Heron.</p>

<h2 id="declaring-output-fields-from-the-spec-method">Declaring output fields from the spec() method</h2>

<p>In Python topologies, the <code>declareOutputFields()</code> method doesn&rsquo;t exist, so
the output fields of your spout and bolt need to be declared by placing
<code>outputs</code> class attributes. This is compatible with the Streamparse API, but
dynamically declaring output fields is more complicated in this way.
So, PyHeron provides a way to dynamically declare output fields via the
<code>optional_outputs</code> argument in the <code>spec()</code> method.</p>

<p>This is useful in a situation like below.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">IdentityBolt</span><span style="color: #f8f8f2">(Bolt):</span>
  <span style="color: #75715e"># can&#39;t statically declare output fields</span>
  <span style="color: #66d9ef">class</span> <span style="color: #a6e22e">process</span><span style="color: #f8f8f2">(self,</span> <span style="color: #f8f8f2">tup):</span>
    <span style="color: #f8f8f2">emit([tup</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">values])</span>
</pre></div>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">class</span> <span style="color: #a6e22e">DynamicOutputField</span><span style="color: #f8f8f2">(Topology):</span>
  <span style="color: #f8f8f2">spout</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">WordSpout</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">spec()</span>
  <span style="color: #f8f8f2">bolt</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">IdentityBolt</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">spec(inputs</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">{spout:</span> <span style="color: #f8f8f2">Grouping</span><span style="color: #f92672">.</span><span style="color: #f8f8f2">ALL},</span>
                           <span style="color: #f8f8f2">optional_outputs</span><span style="color: #f92672">=</span><span style="color: #f8f8f2">[</span><span style="color: #e6db74">&#39;word&#39;</span><span style="color: #f8f8f2">])</span>
</pre></div>

<p>You can also declare outputs in the <code>add_spout()</code> and the <code>add_bolt()</code>
method for the <code>TopologyBuilder</code> in the same way.</p>

<h1 id="launching-your-python-topology">Launching your python topology</h1>

<p>You need to first package your Python topology project to a PEX file.</p>

<p>If you defined your topology using <code>TopologyBuilder</code>, your topology
definition python file should have <code>if __name__ = &quot;__main__&quot;</code> method.
The following shows the submission command of an example WordCountTopology, where its
pex file is located in <code>~/project/word_count.pex</code>.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ heron submit <span style="color: #f8f8f2">local</span> ~/project/word_count.pex - WordCountTopology
</pre></div>

<p>If you defined your topology by subclassing <code>Topology</code>, your topology
definition python file should not contain main method.
The following shows the submission command of an example WordCountTopology, where
its pex file is located in <code>~/project/word_count.pex</code>, inside which your <code>WordCount</code>
class resides under <code>topology.word_count_topology.WordCount</code>.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>$ heron submit <span style="color: #f8f8f2">local</span> <span style="color: #ae81ff">\</span>
~/project/word_count.pex <span style="color: #ae81ff">\</span>
topology.word_count_topology.WordCount <span style="color: #ae81ff">\</span>
WordCountTopology
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="/heron/js/app.min.js"></script></body></html>