# Compiling Heron

Heron is currently available for Mac OS X 10.10, Ubuntu 12.04, and CentOS 5.

You can build Heron either [as an entirety](#building-all-components), on a
[component-by-component basis](#building-specific-components), or as a [release
package](#building-a-full-release-package).

Instructions on running unit tests for Heron can also be found in [Testing Heron](../contributors/testing.html).

## Requirements

You must have the following installed to compile Heron:

* [Bazel](http://bazel.io/docs/install.html) >= {{book.bazel_version}}. More on
  Bazel in the [section below](#installing-bazel).
* [Java
  8](http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html)
  is required only for compilation; [topologies](topologies.html) can be
  written in Java 7 or above and all JARs generated by Bazel are
  compatible with Java 7
* [Autoconf](http://www.gnu.org/software/autoconf/autoconf.html) >=
  2.6.3
* [Automake](https://www.gnu.org/software/automake/) >= 1.11.1
* [GNU Make](https://www.gnu.org/software/make/) >= 3.81
* [GNU Libtool](http://www.gnu.org/software/libtool/) >= 2.4.6
* [gcc/g++](https://gcc.gnu.org/) >= 4.8.2 (Linux platforms)
* [CMake](https://cmake.org/) >= 2.6-patch 4
* [Python](https://www.python.org/) >= 2.7 (not including Python 3.x)
* [Perl](https://www.perl.org/) >= 5.8.8

(TODO: add separate Linux and Mac OS X sections) Export CC and CXX variables

```bash
$ export CC=/usr/bin/clang
$ export CXX=/usr/bin/clang++
$ echo $CC $CXX
```

## Installing Bazel

[Bazel](http://bazel.io) is the build tool used by Heron. The releases page for
Bazel {{book.bazel_version}} can be found
[here](https://github.com/bazelbuild/bazel/releases/tag/{{book.bazel_version}}),
while installation instructions can be found
[here](http://bazel.io/docs/install.html).

## Configuring Bazel

There is a Python script that you can run to configure Bazel on supported
platforms:

```bash
$ cd /path/to/heron/repo
$ ./bazel_configure.py
```

To ensure that Bazel has been installed, run `bazel version` and check the
version (listed next to `Build label` in the script's output) to ensure that you
have Bazel {{book.bazel_version}} or later.

## Building All Components

You can build executables for all Heron components at once (without generating a
release package) using the `bazel build` command. You must specify an
OS-specific configuration using the `--config` flag. This can take one of the
following values: `darwin` (Mac OS X), `ubuntu` (Ubuntu 12.04), `centos5`
(CentOS 5). Here's an example build command:

```bash
$ bazel build --config=darwin heron/...
```

### Build Directory for Component Executables

All component executables generated by Bazel can be found in the `bazel-bin`
folder. The subdirectory varies on the basis of the executable. The
`heron-tracker` executable, for example, can be found at
`bazel-bin/heron/tracker/src/python/heron-tracker`.

## Building Specific Components

As an alternative to building a full release, you can build Heron executables on
a component-by-component basis using the same `bazel build` command. Here's an
example build command for the [Heron Tracker](heron-tracker.html):

```bash
$ bazel build heron/tracker/src/python:heron-tracker
```

Resulting executables can be found in the `bazel-bin` directory.

## Building a Full Release Package

You can build a full Heron release using the `release:packages` [Bazel
target](http://bazel.io/docs/build-ref.html#targets). This will package all
Heron executables into `.tar` and `.tar.gz` files at once. You must specify the
following when building a release package:

* An OS-specific configuration using the `--config` flag. This can take one of
  the following values: `darwin` (Mac OS X), `ubuntu` (Ubuntu 12.04), `centos`
  (CentOS 5).

Here's an example build command:

```bash
$ cd /path/to/heron/repo
$ bazel build --config=darwin release:packages
```

### Build Directory for Full Releases

All `.tar` and `.tar.gz` files generated during Bazel's build process for a full
release can be found in `bazel-bin/release`:

```bash
$ ls bazel-bin/release
bazel-bin/release/heron-api.tar.gz
bazel-bin/release/heron-cli.tar.gz
bazel-bin/release/heron-core.tar.gz
# etc
```

## Testing Heron

There are a wide variety of unit tests available in Heron's codebase. For more
information, see [Testing Heron](../contributors/testing.html).
