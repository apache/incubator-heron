sudo: required

language: java

jdk:
  - oraclejdk8

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-4.8
      - g++-4.8
      - python2.7
      - wget
      - pkg-config
      - zip
      - zlib1g-dev

env:
  - CC=gcc-4.8 CXX=g++-4.8 CPP=cpp-4.8 CXXCPP=cpp-4.8

before_install:

  # download and install libunwind
  #- wget -q http://download.savannah.gnu.org/releases/libunwind/libunwind-1.1.tar.gz
  #- tar xfz libunwind-1.1.tar.gz
  #- cd libunwind-1.1 && ./configure --prefix=/usr && sudo make --silent install && cd ..

  # download and install bazel
  #- wget -q 'https://github.com/bazelbuild/bazel/releases/download/0.1.2/bazel-0.1.2-installer-linux-x86_64.sh'
  #- chmod +x bazel-0.1.2-installer-linux-x86_64.sh
  #- ./bazel-0.1.2-installer-linux-x86_64.sh --user

  - wget -q https://github.com/spf13/hugo/releases/download/v0.15/hugo_0.15_amd64.deb
  - sudo dpkg -i hugo*.deb
  - hugo version
  - sudo pip install --upgrade pip # TODO: might not need this
  - pip -V
  - pip install --user requests>=2.2.0
  - pip list | grep requests
  - python -c 'import sys; print("\n".join(sys.path))'
  - find /usr/lib/python2.7/. -name "*request*"
  - find /usr/lib/python2.7/plat-linux2/. -name "*request*"
  - find /usr/lib/python2.7/lib-tk/. -name "*request*"
  - find /usr/lib/python2.7/lib-old/. -name "*request*"
  - find /usr/lib/python2.7/lib-dynload/. -name "*request*"
  - find /home/travis/.local/lib/python2.7/site-packages/. -name "*request*"
  - find /usr/local/lib/python2.7/dist-packages/. -name "*request*"
  - find /usr/lib/python2.7/dist-packages/. -name "*request*"

  # 0.9.3 fails with "This program requires Python requests 2.2.0 or later." even when that's installed
  - pip install --user LinkChecker==9.2
  - linkchecker --version


before_script:
 - (cd website && npm install && npm install gulp && which gulp)

script:
  - which gcc-4.8
  - gcc --version
  - which g++-4.8
  - g++ --version
  - which gulp
  - pwd
  - (cd website && npm run build && hugo && ./linkchecker.sh)
  #- scripts/travis/build.sh && scripts/travis/test.sh
