group: edge

sudo: required

language: java node_js

jdk:
  - oraclejdk8

node_js:
  - "7"

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-4.8
      - g++-4.8
      - python2.7
      - wget
      - pkg-config
      - zip
      - zlib1g-dev

# Use Yarn caching to speed up the website build process
cache: yarn

env:
  - CC=gcc-4.8 CXX=g++-4.8 CPP=cpp-4.8 CXXCPP=cpp-4.8

before_install:
  # download and install bazel
  - wget -q 'https://github.com/bazelbuild/bazel/releases/download/0.3.1/bazel-0.3.1-installer-linux-x86_64.sh'
  - chmod +x bazel-0.3.1-installer-linux-x86_64.sh
  - ./bazel-0.3.1-installer-linux-x86_64.sh --user

before_script:
  # install python module for wheel files
  # required for python packaging
  - sudo pip install wheel

  # the rest of these before_script items are
  # required for building the website docs

  # install Hugo (for generating the website)
  - wget -q https://github.com/gohugoio/hugo/releases/download/v0.24.1/hugo_0.24.1_Linux-64bit.deb
  - sudo dpkg -i hugo_0.24.1_Linux-64bit.deb
  - hugo version

  # install Python packages necessary for the website
  - sudo pip install pygments==2.1.3 pdoc==0.3.2

  # Install Node.js dependencies for the website
  - (cd website && yarn)

script:
  - which gcc-4.8
  - gcc --version
  - which g++-4.8
  - g++ --version
  - which python
  - python -V
  - which python2.7
  - python2.7 -V
  - scripts/travis/ci.sh
  - (cd website && make travis-site)
